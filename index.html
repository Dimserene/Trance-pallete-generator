<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Trance Palette Generator</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Include Spectrum color picker library -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.1/spectrum.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.1/spectrum.min.js"></script>
    <style>
        /* General Styles */
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            text-align: center;
            padding: 10px;
            margin: 0;
        }
        h1 {
            margin-top: 20px;
            font-size: 1.5em;
        }
        .palette-group {
            margin: 20px 0;
        }
        .group-title {
            font-size: 1.2em;
            margin-bottom: 10px;
            text-decoration: underline;
        }
        .palette-item {
            display: flex;
            flex-wrap: nowrap;
            justify-content: center;
            align-items: center;
            margin: 10px 0;
        }
        .palette-item > div, .palette-item > span {
            margin: 5px;
        }
        .subtitle {
            font-weight: bold;
            min-width: 80px;
        }
        .default-color, .new-color {
            display: inline-block;
            width: 100px;
            padding: 10px;
            color: #fff;
            font-weight: bold;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
        }
        .arrow {
            font-size: 1.2em;
            margin: 0 10px;
            display: inline-block;
        }
        button {
            margin-top: 20px;
            padding: 15px 25px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            background-color: #374244;
            color: #fff;
            border-radius: 5px;
        }
        button:hover {
            background-color: #4f6367;
        }
        /* Responsive adjustments */
        @media (max-width: 600px) {
            h1 {
                font-size: 1.2em;
            }
            .subtitle, .default-color, .new-color {
                width: 80px;
                font-size: 0.9em;
                padding: 8px;
            }
            .arrow {
                margin: 0 5px;
            }
            .palette-item {
                flex-wrap: wrap;
            }
            button {
                padding: 12px 20px;
                font-size: 0.9em;
            }
        }
    </style>
</head>
<body>
    <h1>Trance Palette Generator</h1>

    <div id="palette-container">
        <!-- Main Colors -->
        <div class="palette-group">
            <div class="group-title">Main Colors</div>
            <!-- SPLASH -->
            <div class="palette-item">
                <div class="subtitle">SPLASH</div>
                <span class="default-color" style="background-color: #FE5F55;">#FE5F55</span>
                <span class="arrow">→</span>
                <span class="new-color" id="SPLASH" style="background-color: #FE5F55;">#FE5F55</span>
            </div>
            <!-- MULT -->
            <div class="palette-item">
                <div class="subtitle">MULT</div>
                <span class="default-color" style="background-color: #FE5F55;">#FE5F55</span>
                <span class="arrow">→</span>
                <span class="new-color" id="MULT" style="background-color: #FE5F55;">#FE5F55</span>
            </div>
            <!-- CHIPS -->
            <div class="palette-item">
                <div class="subtitle">CHIPS</div>
                <span class="default-color" style="background-color: #009DFF;">#009DFF</span>
                <span class="arrow">→</span>
                <span class="new-color" id="CHIPS" style="background-color: #009DFF;">#009DFF</span>
            </div>
            <!-- PLASMA -->
            <div class="palette-item">
                <div class="subtitle">PLASMA</div>
                <span class="default-color" style="background-color: #CC73D9;">#CC73D9</span>
                <span class="arrow">→</span>
                <span class="new-color" id="PLASMA" style="background-color: #CC73D9;">#CC73D9</span>
            </div>
            <!-- MONEY -->
            <div class="palette-item">
                <div class="subtitle">MONEY</div>
                <span class="default-color" style="background-color: #F3B958;">#F3B958</span>
                <span class="arrow">→</span>
                <span class="new-color" id="MONEY" style="background-color: #F3B958;">#F3B958</span>
            </div>
            <!-- Continue adding other main colors similarly -->
        </div>

        <!-- UI Colors -->
        <div class="palette-group">
            <div class="group-title">UI Colors</div>
            <!-- TEXT_LIGHT -->
            <div class="palette-item">
                <div class="subtitle">TEXT_LIGHT</div>
                <span class="default-color" style="background-color: #FFFFFF;">#FFFFFF</span>
                <span class="arrow">→</span>
                <span class="new-color" id="UI_TEXT_LIGHT" style="background-color: #FFFFFF;">#FFFFFF</span>
            </div>
            <!-- TEXT_DARK -->
            <div class="palette-item">
                <div class="subtitle">TEXT_DARK</div>
                <span class="default-color" style="background-color: #4F6367;">#4F6367</span>
                <span class="arrow">→</span>
                <span class="new-color" id="UI_TEXT_DARK" style="background-color: #4F6367;">#4F6367</span>
            </div>
            <!-- Continue with other UI colors... -->
        </div>

        <!-- BOSSES Colors -->
        <div class="palette-group">
            <div class="group-title">Bosses Colors</div>
            <!-- bl_ox -->
            <div class="palette-item">
                <div class="subtitle">bl_ox</div>
                <span class="default-color" style="background-color: #B95B08;">#B95B08</span>
                <span class="arrow">→</span>
                <span class="new-color" id="BOSSES_bl_ox" style="background-color: #B95B08;">#B95B08</span>
            </div>
            <!-- Add other BOSSES colors similarly -->
        </div>

        <!-- SET Colors -->
        <div class="palette-group">
            <div class="group-title">Set Colors</div>
            <!-- Default -->
            <div class="palette-item">
                <div class="subtitle">Default</div>
                <span class="default-color" style="background-color: #CDD9DC;">#CDD9DC</span>
                <span class="arrow">→</span>
                <span class="new-color" id="SET_Default" style="background-color: #CDD9DC;">#CDD9DC</span>
            </div>
            <!-- Add other SET colors similarly -->
        </div>

        <!-- Continue adding groups for other categories like SECONDARY_SET, RARITY, SO_1, SO_2, etc. -->

    </div>

    <!-- Button to Export the Palette -->
    <button onclick="exportPalette()">Export Palette</button>

    <script>
        // Initialize Spectrum Color Pickers for each new-color span
        function initializeSpectrum() {
            document.querySelectorAll('.new-color').forEach(function(el) {
                $(el).spectrum({
                    color: el.style.backgroundColor,
                    showInput: true,
                    showInitial: true,
                    preferredFormat: "hex",
                    change: function(color) {
                        updateColor(el, color.toHexString());
                    }
                });
            });
        }

        // Function to update the new color and background dynamically
        function updateColor(element, colorValue) {
            element.style.backgroundColor = colorValue;
            element.textContent = colorValue.toUpperCase();
            element.style.color = getContrastingColor(colorValue);
        }

        // Function to get contrasting text color (black or white) for better readability
        function getContrastingColor(hexColor) {
            const r = parseInt(hexColor.substr(1,2),16);
            const g = parseInt(hexColor.substr(3,2),16);
            const b = parseInt(hexColor.substr(5,2),16);
            const brightness = (r * 299 + g * 587 + b * 114) / 1000;
            return brightness > 125 ? '#000' : '#fff';
        }

        // Function to export the palette as a Lua file
        function exportPalette() {
            const palette = {
                SPLASH: document.getElementById('SPLASH').style.backgroundColor,
                MULT: document.getElementById('MULT').style.backgroundColor,
                CHIPS: document.getElementById('CHIPS').style.backgroundColor,
                PLASMA: document.getElementById('PLASMA').style.backgroundColor,
                MONEY: document.getElementById('MONEY').style.backgroundColor,
                UI: {
                    TEXT_LIGHT: document.getElementById('UI_TEXT_LIGHT').style.backgroundColor,
                    TEXT_DARK: document.getElementById('UI_TEXT_DARK').style.backgroundColor,
                },
                BOSSES: {
                    bl_ox: document.getElementById('BOSSES_bl_ox').style.backgroundColor,
                },
                SET: {
                    Default: document.getElementById('SET_Default').style.backgroundColor,
                },
                // Add other groups similarly...
            };

            // Function to convert the palette object to Lua table string
            function toLuaTable(obj, indent) {
                let lua = '';
                const indentation = '    '.repeat(indent);
                if (typeof obj === 'object') {
                    lua += '{\n';
                    for (let key in obj) {
                        lua += `${indentation}${key} = `;
                        if (typeof obj[key] === 'object') {
                            lua += toLuaTable(obj[key], indent + 1);
                        } else {
                            lua += `HEX('${rgbToHex(obj[key])}'),\n`;
                        }
                    }
                    lua += `${indentation.slice(4)}}`;
                } else {
                    lua += `HEX('${rgbToHex(obj)}')`;
                }
                return lua;
            }

            // Helper function to convert RGB to Hex
            function rgbToHex(rgb) {
                const result = /^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/.exec(rgb);
                return result
                    ? "#" + ((1 << 24) | (result[1] << 16) | (result[2] << 8) | result[3]).toString(16).slice(1).toUpperCase()
                    : rgb;
            }

            let luaScript = 'return ' + toLuaTable(palette, 0);

            // Create a Blob object representing the Lua file
            const blob = new Blob([luaScript], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'trance_palette.lua';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Initialize Spectrum color pickers on page load
        document.addEventListener('DOMContentLoaded', initializeSpectrum);
    </script>
</body>
</html>
