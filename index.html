<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Color Picker and Editor with Reset All and Lua Export</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Mobile friendly -->
    <!-- Include Spectrum CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.1/spectrum.min.css">
    <style>
        /* Base CSS Styles */
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 0;
        }
        h1 {
            text-align: center;
            padding: 0.5em;
            background-color: #374244;
            color: #ffffff;
            margin: 0;
            font-size: 1.5em;
        }
        #colorContainer {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5em;
        }
        .category {
            width: 100%;
            max-width: 1200px;
            margin: 0.5em 0;
            background-color: #ffffff;
            border-radius: 4px;
            box-sizing: border-box;
            padding: 0.5em;
            display: block; /* Ensure block display */
        }
        .category h2 {
            margin: 1em 0 0.5em 0;
            font-size: 1.2em;
            text-align: left;
            border-bottom: 1px solid #ccc;
            padding-bottom: 0.25em;
            display: block; /* Ensure block display */
            width: 100%; /* Ensure it takes full width */
        }
        .color-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 0.5em;
        }
        .color-item {
            display: flex;
            align-items: center;
            padding: 0.25em;
            background-color: #f9f9f9;
            border-radius: 4px;
            flex-wrap: nowrap; /* Ensure elements stay on a single line */
        }
        .color-name {
            flex: 1 1 auto;
            min-width: 0; /* Allows text to shrink */
            font-size: 0.9em;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-right: 0.25em;
        }
        .controls-container {
            display: flex;
            align-items: center;
            flex-wrap: nowrap;
        }
        .controls-container > * {
            flex: 0 0 auto;
            margin-right: 0.25em;
        }
        .color-original,
        .arrow,
        .color-picker {
            width: 1.2em;
        }
        .hex-input {
            width: 5em;
            padding: 0.2em;
            font-size: 0.8em;
            border: 1px solid #cccccc;
            border-radius: 2px;
            text-transform: uppercase;
        }
        .reset-button {
            width: 1.2em;
            height: 1.2em;
            background: url('https://raw.githubusercontent.com/Dimserene/Trance-pallete-generator/main/reset.png') no-repeat center;
            background-size: contain;
            border: none;
            cursor: pointer;
            padding: 0;
            margin-right: 0.25em;
        }
        #resetAllButton,
        #exportLuaButton {
            display: inline-block;
            margin: 0.5em;
            padding: 0.5em 1em;
            font-size: 1em;
            background-color: #374244;
            color: #ffffff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #resetAllButton:hover,
        #exportLuaButton:hover {
            background-color: #4f6367;
        }
        #exportLuaOutput {
            width: calc(100% - 1em);
            max-width: 1200px;
            height: 150px;
            margin: 0.5em auto;
            display: block;
            font-family: monospace;
            padding: 0.5em;
            box-sizing: border-box;
            border: 1px solid #cccccc;
            border-radius: 4px;
            resize: vertical;
        }
        /* Mobile Styles */
        @media (max-width: 600px) {
            .category {
                padding: 0.25em;
                display: block; /* Ensure block display */
            }
            .category h2 {
                font-size: 1em;
                margin: 1em 0 0.25em 0; /* Add top margin */
                padding-bottom: 0.25em;
                display: block; /* Ensure block display */
                width: 100%; /* Ensure it takes full width */
            }
            .color-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 0.25em;
            }
            .color-item {
                padding: 0.25em;
                flex-wrap: nowrap; /* Keep elements on a single line */
                align-items: center;
            }
            .color-name {
                font-size: 0.8em;
                margin-right: 0.25em;
                flex: 1 1 auto;
                min-width: 0; /* Allows text to shrink */
            }
            .controls-container > * {
                margin-right: 0.25em;
            }
            .color-original,
            .arrow,
            .color-picker,
            .reset-button {
                width: 1em;
                height: 1em;
            }
            .hex-input {
                width: 4em;
            }
            /* Remove margin-bottom from elements */
            .color-original,
            .arrow,
            .color-picker,
            .hex-input {
                margin-bottom: 0;
            }
            #resetAllButton,
            #exportLuaButton {
                margin: 0.25em;
                padding: 0.5em 1em;
            }
            #exportLuaOutput {
                height: 120px;
                margin: 0.25em auto;
            }
        }
    </style>
</head>
<body>

    <h1>Color Picker and Editor</h1>

    <div id="colorContainer"></div>

    <div style="text-align: center;">
        <button id="resetAllButton">Reset All</button>
        <button id="exportLuaButton">Export</button>
    </div>
    <textarea id="exportLuaOutput" placeholder="Updated colors in Lua format will appear here..."></textarea>

    <!-- Include jQuery (Spectrum dependency) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Include Spectrum JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.1/spectrum.min.js"></script>
    <script>
        // Original color data (deep copy to preserve defaults)
        const defaultColorData = {
            SPLASH: ['FE5F55', '009DFF'],
            MULT: 'FE5F55',
            STAR: 'F7C59F',
            SUPER: '4F6367',
            LEVEL: '4F6367',
            MOVER: 'EEEEEE',
            ICON: '4F6367',
            BG: {
                DEFAULT: 'FFFFFF',
                DEFAULT_ALPHA: '00000000',
                MENU: '000000',
                OVERLAY: '4F6367',
                EDITOR_BG: '000000',
                EDITOR_GRID: 'EEEEEE',
                BOTTOM: '333333',
                SELECT: '000000',
                HIDDEN: '7F7F7F7F',
                HELP_BG: '0000007F',
                ACHIEVEMENT: '7F7F7F7F',
                MODS: '222222',
                MOD_TABS: '4F6367',
                GD_PANEL: '000000',
                POPUP: '333333',
                PAUSE: '0000007F',
                GD_BG: '000000',
                GD_TAB: '000000',
                GD_TEXT: 'FFFFFF',
                SHAD: 'FFFFFF',
                LEVEL_SHAD: 'FFFFFF',
                SUB_BG: '000000',
                LOGO: 'FFFFFF',
                WATERY: '7F7F7F7F',
                OUTLINE: '000000',
                BARS: 'CCCCCC',
                TEXTEDITOR: '000000',
                SHADTEXTEDITOR: 'FFFFFF',
                ITEM: '00000000',
                STRONGER: 'CCCCCC',
                HELP_TOGGLE: '000000',
                HUEBG: '000000',
                LAYER_BG: '0000007F',
                LINE: 'CCCCCC',
                PULSELIGHT: 'FFFFFF',
                PULSEDARK: '000000',
                WAVE_L1: 'FFFFFF',
                WAVE_L2: 'FFFFFF',
                WAVE_L3: 'FFFFFF',
                WAVECIRCLE: '000000',
                FLAMES: 'FF0000',
                WATER: '0000FF',
                FIRE: 'FF0000',
                FIRE_END: 'FFFFFF',
                SHOCK: 'FF0000',
                BLAST: 'FF0000',
                FOG: 'FFFFFF7F',
                CREDITS_BG: '000000',
                HINT_BG: '0000007F',
                TEXT_BORDER: '000000'
            },
            TEXT: {
                DEFAULT: 'FFFFFF',
                PROMPT: 'FFFFFF',
                INPUT: '000000',
                HINT: 'FFFFFF',
                HINT_SHAD: '000000',
                SELECTED: 'F7C59F',
                ONLINE: '4F6367',
                ONLINE_SELECTED: 'FE5F55',
                SUBTEXT: 'FFFFFF',
                PLACEHOLDER: 'CCCCCC',
                MENU_MUSIC: '000000',
                MENU_AUTHOR: '000000',
                MENU_DESCRIPTION: '000000',
                BUTTON: '000000',
                BUTTON_SHAD: 'FFFFFF',
                MESSAGE: '000000',
                MESSAGE_SHAD: 'FFFFFF',
                DESCRIPTION: 'FFFFFF',
                DESCRIPTION_SHAD: '000000',
                PROGRESS: '000000',
                PROGRESS_SHAD: 'FFFFFF',
                MULTI: 'FFFFFF',
                WATERMARK: '000000',
                WATERMARK_SHAD: 'FFFFFF',
                TIMER: 'FFFFFF',
                STRONGER: 'CCCCCC',
                NUMBER: 'FFFFFF',
                LAYER_NAME: 'FFFFFF',
                LAYER_SHAD: '000000',
                SELECTOR: '000000',
                SELECTOR_SHAD: 'FFFFFF',
                SELECTOR_DES: 'FFFFFF',
                SELECTOR_DSHAD: '000000',
                HELP: 'FFFFFF',
                HELPSHAD: '000000',
                HELPBG: '000000',
                ACHIEVEMENT: 'FFFFFF',
                ACHIEVEMENT_SHAD: '000000',
                ACHIEVEMENT_DES: 'FFFFFF',
                ACHIEVEMENT_DES_SHAD: '000000',
                MODS: 'FFFFFF',
                MODS_SHAD: '000000',
                MODS_HOVER: 'FFFFFF',
                MODS_HOVER_SHAD: '000000',
                MODS_HELP: 'FFFFFF',
                MODS_HELP_SHAD: '000000',
                MODS_TOGGLED: 'FFFFFF',
                MODS_TOGGLED_SHAD: '000000',
                MODS_TABS: '000000',
                MODS_TABS_SHAD: 'FFFFFF',
                MODS_TABS_SELECT: 'FFFFFF',
                MODS_TABS_SELECT_SHAD: '000000',
                GD_LEVEL: 'FFFFFF',
                GD_LEVEL_SHAD: '000000',
                GD_CREATOR: 'FFFFFF',
                GD_CREATOR_SHAD: '000000',
                GD_DESC: 'FFFFFF',
                GD_DESC_SHAD: '000000',
                GD_PANEL: 'FFFFFF',
                GD_PANEL_SHAD: '000000',
                GD_SEARCH: '000000',
                GD_SEARCH_SHAD: 'FFFFFF',
                GD_SEARCH_DES: 'FFFFFF',
                GD_SEARCH_DES_SHAD: '000000',
                SHAD: '000000',
                SHAD_CLICK: 'FFFFFF',
                SUBTEXT_SHAD: '000000',
                BLACK: '000000',
                WHITE: 'FFFFFF',
                GREY: '7F7F7F',
                HINT_TOGGLE: '000000',
                MENU_HELP: 'FFFFFF',
                MENU_SHAD: '000000',
                LAYER_HELP: 'FFFFFF',
                EDITOR_BG: 'FFFFFF',
                EDITOR_TEXT: '000000',
                HELP_DES: 'FFFFFF',
                HELP_DES_SHAD: '000000',
                HELP_INVERT: '000000',
                HELP_SHAD_INVERT: 'FFFFFF',
                PAUSE: 'FFFFFF',
                PAUSE_SHAD: '000000',
                HUE_TEXT: 'FFFFFF',
                HUE_SHAD: '000000',
                WATERY: 'FFFFFF',
                SECRET: 'FFFFFF',
                SECRET_SHAD: '000000',
                REPLAYSPEED: '000000',
                REPLAYSPEED_SHAD: 'FFFFFF',
                SMALLTEXT: 'FFFFFF',
                SMALLTEXT_SHAD: '000000',
                CREDITS_TEXT: 'FFFFFF',
                CREDITS_SHAD: '000000',
                HINT_TEXT: 'FFFFFF',
                HINT_TEXT_SHAD: '000000'
            }
            // Add any additional categories and colors as needed
        };

        // Copy of color data that will be modified
        let colorData = JSON.parse(JSON.stringify(defaultColorData));

        // Store references to Spectrum instances
        const spectrumInstances = [];

        // Function to create color pickers using Spectrum
        function createColorPickers(data, container, categoryName, defaultData) {
            const categoryDiv = document.createElement('div');
            categoryDiv.className = 'category';

            if (categoryName) {
                const categoryTitle = document.createElement('h2');
                categoryTitle.textContent = categoryName;
                categoryDiv.appendChild(categoryTitle);
            }

            const colorGrid = document.createElement('div');
            colorGrid.className = 'color-grid';

            for (const key in data) {
                if (typeof data[key] === 'object' && !Array.isArray(data[key])) {
                    createColorPickers(data[key], categoryDiv, key, defaultData[key]);
                } else if (Array.isArray(data[key])) {
                    data[key].forEach((item, index) => {
                        createColorItem(item, `${key}[${index}]`, data[key], index, colorGrid, defaultData[key]);
                    });
                } else {
                    createColorItem(data[key], key, data, key, colorGrid, defaultData);
                }
            }

            categoryDiv.appendChild(colorGrid);
            container.appendChild(categoryDiv);
        }

        function createColorItem(colorValue, displayName, parentData, dataKey, container, defaultParentData) {
            const defaultColorValue = Array.isArray(defaultParentData) ? defaultParentData[dataKey] : defaultParentData[dataKey];

            const colorItem = document.createElement('div');
            colorItem.className = 'color-item';

            const colorName = document.createElement('div');
            colorName.className = 'color-name';
            colorName.textContent = displayName;

            const colorOriginal = document.createElement('div');
            colorOriginal.className = 'color-original';
            colorOriginal.style.backgroundColor = '#' + defaultColorValue.slice(0, 6);

            const arrow = document.createElement('div');
            arrow.className = 'arrow';
            arrow.textContent = 'â†’';

            // Create an input for Spectrum
            const colorInput = document.createElement('input');
            colorInput.type = 'text';
            colorInput.className = 'color-picker';

            // Set initial value (including alpha)
            let hexColor = colorValue.slice(0, 6).toUpperCase();
            let alpha = colorValue.length >= 8 ? parseInt(colorValue.slice(6, 8), 16) / 255 : 1;

            colorInput.value = '#' + colorValue.slice(0, 6);

            const hexInput = document.createElement('input');
            hexInput.type = 'text';
            hexInput.value = colorValue.toUpperCase();
            hexInput.className = 'hex-input';
            hexInput.maxLength = 8;

            // Reset Button
            const resetButton = document.createElement('button');
            resetButton.className = 'reset-button';
            resetButton.title = 'Reset to Default';
            resetButton.addEventListener('click', function() {
                // Reset data
                parentData[dataKey] = defaultColorValue;
                // Update Spectrum color picker
                const defaultHexColor = defaultColorValue.slice(0, 6).toUpperCase();
                const defaultAlpha = defaultColorValue.length >= 8 ? parseInt(defaultColorValue.slice(6, 8), 16) / 255 : 1;
                const defaultColorString = '#' + defaultHexColor + (defaultAlpha < 1 ? defaultColorValue.slice(6, 8) : '');
                $(colorInput).spectrum("set", defaultColorString);
                // Update hex input
                hexInput.value = defaultColorValue.toUpperCase();
            });

            // Append elements
            colorItem.appendChild(colorName);

            const controlsContainer = document.createElement('div');
            controlsContainer.className = 'controls-container';

            controlsContainer.appendChild(colorOriginal);
            controlsContainer.appendChild(arrow);
            controlsContainer.appendChild(colorInput);
            controlsContainer.appendChild(hexInput);
            controlsContainer.appendChild(resetButton);

            colorItem.appendChild(controlsContainer);
            container.appendChild(colorItem);

            // Initialize Spectrum on the colorInput
            const spectrumInstance = $(colorInput).spectrum({
                color: '#' + hexColor + (alpha < 1 ? Math.round(alpha * 255).toString(16).padStart(2, '0') : ''),
                showInput: false,
                showInitial: false,
                preferredFormat: "hex8",
                showAlpha: true,
                move: function(tinycolor) {
                    const newHex8 = tinycolor.toHex8String().toUpperCase();
                    hexInput.value = newHex8.slice(1);
                },
                change: function(tinycolor) {
                    const newHex8 = tinycolor.toHex8String().toUpperCase();
                    hexInput.value = newHex8.slice(1);
                    parentData[dataKey] = newHex8.slice(1);
                }
            });

            // Store reference for reset all functionality
            spectrumInstances.push({
                spectrumInstance: spectrumInstance,
                colorInput: colorInput,
                hexInput: hexInput,
                parentData: parentData,
                dataKey: dataKey,
                defaultColorValue: defaultColorValue
            });

            // Update functions
            function updateColor(newColor) {
                if (/^[0-9A-Fa-f]{6,8}$/.test(newColor)) {
                    let colorString = '#' + newColor;
                    $(colorInput).spectrum("set", colorString);
                    parentData[dataKey] = newColor.toUpperCase();
                }
            }

            hexInput.addEventListener('input', function() {
                const newHex = hexInput.value.toUpperCase();
                if (/^[0-9A-Fa-f]{6,8}$/.test(newHex)) {
                    updateColor(newHex);
                }
            });

            hexInput.addEventListener('blur', function() {
                // Validate hex code on blur
                if (!/^[0-9A-Fa-f]{6,8}$/.test(hexInput.value)) {
                    const currentHex = parentData[dataKey].toUpperCase();
                    hexInput.value = currentHex;
                }
            });
        }

        // Initialize the color pickers
        const colorContainer = document.getElementById('colorContainer');
        createColorPickers(colorData, colorContainer, null, defaultColorData);

        // Reset All functionality
        document.getElementById('resetAllButton').addEventListener('click', function() {
            if (confirm('Are you sure you want to reset all colors to their default values? This action cannot be undone.')) {
                // Reset colorData to defaultColorData
                colorData = JSON.parse(JSON.stringify(defaultColorData));

                // Update all Spectrum instances and hex inputs
                spectrumInstances.forEach(function(item) {
                    // Update parent data
                    item.parentData[item.dataKey] = item.defaultColorValue;
                    // Update Spectrum color picker
                    const defaultHexColor = item.defaultColorValue.slice(0, 6).toUpperCase();
                    const defaultAlpha = item.defaultColorValue.length >= 8 ? parseInt(item.defaultColorValue.slice(6, 8), 16) / 255 : 1;
                    const defaultColorString = '#' + defaultHexColor + (defaultAlpha < 1 ? item.defaultColorValue.slice(6, 8) : '');
                    $(item.colorInput).spectrum("set", defaultColorString);
                    // Update hex input
                    item.hexInput.value = item.defaultColorValue.toUpperCase();
                });
            }
        });

        // Export to Lua functionality
        document.getElementById('exportLuaButton').addEventListener('click', function() {
            const exportedLua = 'return ' + convertToLuaTable(colorData);
            document.getElementById('exportLuaOutput').value = exportedLua;
        });

        // Function to convert JSON object to Lua table format
        function convertToLuaTable(obj, indent = '') {
            let lua = '{\n';
            const indent2 = indent + '    ';
            for (const key in obj) {
                const value = obj[key];
                lua += indent2;
                if (/^[a-zA-Z_][a-zA-Z0-9_]*$/.test(key)) {
                    lua += key + ' = ';
                } else {
                    lua += '["' + key + '"] = ';
                }
                if (typeof value === 'string') {
                    lua += '"' + value + '",\n';
                } else if (typeof value === 'number') {
                    lua += value + ',\n';
                } else if (typeof value === 'boolean') {
                    lua += (value ? 'true' : 'false') + ',\n';
                } else if (Array.isArray(value)) {
                    lua += '{ ';
                    value.forEach(function(item) {
                        if (typeof item === 'string') {
                            lua += '"' + item + '", ';
                        } else {
                            lua += item + ', ';
                        }
                    });
                    lua += '},\n';
                } else if (typeof value === 'object') {
                    lua += convertToLuaTable(value, indent2) + ',\n';
                } else {
                    lua += 'nil,\n';
                }
            }
            lua += indent + '}';
            return lua;
        }
    </script>
</body>
</html>
